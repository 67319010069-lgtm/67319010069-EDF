(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[41],{7050:function(e,s,t){Promise.resolve().then(t.bind(t,6002))},7907:function(e,s,t){"use strict";var a=t(5313);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},6002:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return d}});var a=t(3827),n=t(4090),l=t(7907),r=t(8792),i=t(4958),c=t(1399);function d(){var e,s,t,d,o,u,m;let x=(0,l.useParams)(),p=(0,l.useRouter)(),h=x.id,[f,g]=(0,n.useState)(null),[v,j]=(0,n.useState)(null),[b,w]=(0,n.useState)(null),[N,y]=(0,n.useState)(!0),[k,_]=(0,n.useState)(!1);(0,n.useEffect)(()=>{I()},[h]);let I=async()=>{let{user:e}=await i.auth.getUser();j(e);let{data:s}=await i.db.getCourse(h);if(g(s),e){let{data:s}=await i.db.getEnrollment(e.id,h);w(s)}y(!1)},q=async()=>{if(!v){p.push("/auth/login");return}_(!0);let{data:e,error:s}=await i.db.createEnrollment(v.id,h);s||(w(e),p.push("/learn/".concat(h))),_(!1)};if(N)return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-pink-100 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-2xl text-pink-500",children:"กำลังโหลด..."})});if(!f)return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-pink-100 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"ไม่พบคอร์สนี้"}),(0,a.jsx)(r.default,{href:"/courses",className:"text-pink-500 hover:underline",children:"กลับไปหน้าคอร์ส"})]})});let S=(null===(e=f.reviews)||void 0===e?void 0:e.length)>0?f.reviews.reduce((e,s)=>e+s.rating,0)/f.reviews.length:0;return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-pink-100 text-gray-900",children:[(0,a.jsx)("nav",{className:"glass sticky top-0 z-50 border-b border-white/20",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(r.default,{href:"/",className:"flex items-center space-x-2",children:[(0,a.jsx)(c.nGB,{className:"text-3xl text-pink-500"}),(0,a.jsx)("span",{className:"text-2xl font-bold bg-gradient-to-r from-pink-400 to-pink-600 bg-clip-text text-transparent",children:"Eduflow"})]}),(0,a.jsxs)(r.default,{href:"/courses",className:"px-4 py-2 text-gray-800 hover:text-pink-600 font-medium",children:[(0,a.jsx)(c.x_l,{className:"inline mr-2"}),"กลับ"]})]})})}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-2",children:[(0,a.jsxs)("div",{className:"glass p-8 rounded-2xl mb-6",children:[f.thumbnail&&(0,a.jsx)("img",{src:f.thumbnail,alt:f.title,className:"w-full h-64 object-cover rounded-lg mb-6"}),(0,a.jsx)("h1",{className:"text-4xl font-bold mb-4 text-gray-900",children:f.title}),(0,a.jsx)("p",{className:"text-lg text-gray-700 mb-6",children:f.description}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.QJe,{className:"text-yellow-500"}),(0,a.jsx)("span",{className:"font-semibold",children:S>0?S.toFixed(1):"ยังไม่มีรีวิว"}),(null===(s=f.reviews)||void 0===s?void 0:s.length)>0&&(0,a.jsxs)("span",{className:"text-gray-600",children:["(",f.reviews.length," รีวิว)"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.Mp$,{className:"text-pink-500"}),(0,a.jsxs)("span",{children:[(null===(t=f.lessons)||void 0===t?void 0:t.length)||0," บทเรียน"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.Xws,{className:"text-pink-600"}),(0,a.jsxs)("span",{children:["โดย ",null===(d=f.instructor)||void 0===d?void 0:d.full_name]})]})]}),(0,a.jsx)("div",{className:"inline-block px-4 py-2 bg-pink-100 text-pink-600 rounded-full font-medium",children:f.category})]}),(0,a.jsxs)("div",{className:"glass p-8 rounded-2xl mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"เนื้อหาในคอร์ส"}),(0,a.jsx)("div",{className:"space-y-3",children:null===(o=f.lessons)||void 0===o?void 0:o.map((e,s)=>(0,a.jsx)("div",{className:"bg-white p-4 rounded-lg border border-gray-200 flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center font-bold text-pink-500",children:s+1}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 text-sm text-gray-700",children:[(0,a.jsx)("span",{className:"capitalize",children:e.type}),e.duration&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"•"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(c.qyc,{}),(0,a.jsx)("span",{children:e.duration})]})]})]})]})]})},e.id))})]}),(null===(u=f.reviews)||void 0===u?void 0:u.length)>0&&(0,a.jsxs)("div",{className:"glass p-8 rounded-2xl",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"รีวิวจากผู้เรียน"}),(0,a.jsx)("div",{className:"space-y-4",children:f.reviews.map(e=>{var s;return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(c.Xws,{className:"text-pink-500"})}),(0,a.jsx)("span",{className:"font-semibold",children:null===(s=e.user)||void 0===s?void 0:s.full_name})]}),(0,a.jsx)("div",{className:"flex items-center space-x-1",children:[void 0,void 0,void 0,void 0,void 0].map((s,t)=>(0,a.jsx)(c.QJe,{className:t<e.rating?"text-yellow-500":"text-gray-300"},t))})]}),e.comment&&(0,a.jsx)("p",{className:"text-gray-700",children:e.comment})]},e.id)})})]})]}),(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsxs)("div",{className:"glass p-6 rounded-2xl sticky top-24",children:[(0,a.jsx)("div",{className:"text-4xl font-bold text-pink-500 mb-6",children:f.price>0?"฿".concat(f.price):"ฟรี"}),b?(0,a.jsx)(r.default,{href:"/learn/".concat(h),className:"block w-full text-center px-6 py-4 bg-gradient-to-r from-pink-400 to-pink-600 text-white rounded-lg hover:shadow-lg hover:scale-105 font-semibold mb-4",children:"เข้าเรียน"}):(0,a.jsx)("button",{onClick:q,disabled:k,className:"w-full px-6 py-4 bg-gradient-to-r from-pink-400 to-pink-600 text-white rounded-lg hover:shadow-lg hover:scale-105 font-semibold mb-4 disabled:opacity-50",children:k?"กำลังลงทะเบียน...":"ลงทะเบียนเรียน"}),(0,a.jsxs)("div",{className:"space-y-3 text-sm text-gray-700",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"บทเรียน"}),(0,a.jsxs)("span",{className:"font-semibold",children:[(null===(m=f.lessons)||void 0===m?void 0:m.length)||0," บท"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"ผู้เรียน"}),(0,a.jsx)("span",{className:"font-semibold",children:"-"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"ระดับ"}),(0,a.jsx)("span",{className:"font-semibold",children:"ทุกระดับ"})]})]})]})})]})})]})}},4958:function(e,s,t){"use strict";t.r(s),t.d(s,{auth:function(){return n},db:function(){return l},storage:function(){return r},supabase:function(){return a}});let a=(0,t(7688).eI)("https://ctnmxbhrlqcboztdumgb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0bm14YmhybHFjYm96dGR1bWdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NTA0MzgsImV4cCI6MjA4NjMyNjQzOH0.CBikuMmopGp_wOQvlVNIQXuBQ-dQ7DysT05tpgA156E"),n={signUp:async function(e,s,t){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"student",{data:l,error:r}=await a.auth.signUp({email:e,password:s,options:{data:{full_name:t,role:n,password:s}}});return{data:l,error:r}},signIn:async(e,s)=>{let{data:t,error:n}=await a.auth.signInWithPassword({email:e,password:s});return{data:t,error:n}},signOut:async()=>{let{error:e}=await a.auth.signOut();return{error:e}},getSession:async()=>{let{data:{session:e},error:s}=await a.auth.getSession();return{session:e,error:s}},getUser:async()=>{let{data:{user:e},error:s}=await a.auth.getUser();return{user:e,error:s}}},l={getProfile:async e=>{let{data:s,error:t}=await a.from("profiles").select("*").eq("id",e).single();return{data:s,error:t}},updateProfile:async(e,s)=>{let{data:t,error:n}=await a.from("profiles").update(s).eq("id",e).select().single();return{data:t,error:n}},getCourses:async e=>{let s=a.from("courses").select("\n      *,\n      instructor:profiles!instructor_id(full_name, avatar_url),\n      lessons(id),\n      reviews(rating)\n    ");(null==e?void 0:e.published)!==void 0&&(s=s.eq("published",e.published)),(null==e?void 0:e.category)&&(s=s.eq("category",e.category)),(null==e?void 0:e.search)&&(s=s.ilike("title","%".concat(e.search,"%")));let{data:t,error:n}=await s.order("created_at",{ascending:!1});return{data:t,error:n}},getCourse:async e=>{let{data:s,error:t}=await a.from("courses").select("\n        *,\n        instructor:profiles!instructor_id(full_name, avatar_url, email),\n        lessons(*),\n        reviews(id, rating, comment, created_at, user:profiles(full_name, avatar_url))\n      ").eq("id",e).single();return{data:s,error:t}},createCourse:async e=>{let{data:s,error:t}=await a.from("courses").insert(e).select().single();return{data:s,error:t}},updateCourse:async(e,s)=>{let{data:t,error:n}=await a.from("courses").update({...s,updated_at:new Date().toISOString()}).eq("id",e).select().single();return{data:t,error:n}},deleteCourse:async e=>{let{error:s}=await a.from("courses").delete().eq("id",e);return{error:s}},createLesson:async e=>{let{data:s,error:t}=await a.from("lessons").insert(e).select().single();return{data:s,error:t}},updateLesson:async(e,s)=>{let{data:t,error:n}=await a.from("lessons").update(s).eq("id",e).select().single();return{data:t,error:n}},deleteLesson:async e=>{let{error:s}=await a.from("lessons").delete().eq("id",e);return{error:s}},getEnrollment:async(e,s)=>{let{data:t,error:n}=await a.from("enrollments").select("*").eq("user_id",e).eq("course_id",s).single();return{data:t,error:n}},getUserEnrollments:async e=>{let{data:s,error:t}=await a.from("enrollments").select("\n        *,\n        course:courses(*, instructor:profiles!instructor_id(full_name), lessons(id))\n      ").eq("user_id",e).order("enrolled_at",{ascending:!1});return{data:s,error:t}},createEnrollment:async(e,s)=>{let{data:t,error:n}=await a.from("enrollments").insert({user_id:e,course_id:s}).select().single();return{data:t,error:n}},updateProgress:async(e,s)=>{let{data:t,error:n}=await a.from("enrollments").update({progress:s}).eq("id",e).select().single();return{data:t,error:n}},createReview:async e=>{let{data:s,error:t}=await a.from("reviews").insert(e).select().single();return{data:s,error:t}},updateReview:async(e,s)=>{let{data:t,error:n}=await a.from("reviews").update({...s,updated_at:new Date().toISOString()}).eq("id",e).select().single();return{data:t,error:n}},getUserReview:async(e,s)=>{let{data:t,error:n}=await a.from("reviews").select("*").eq("user_id",e).eq("course_id",s).single();return{data:t,error:n}}},r={uploadAvatar:async(e,s)=>{let t=s.name.split(".").pop(),n="".concat(e,".").concat(t),{data:l,error:r}=await a.storage.from("avatars").upload(n,s,{upsert:!0});if(r)return{data:null,error:r};let{data:{publicUrl:i}}=a.storage.from("avatars").getPublicUrl(n);return{data:i,error:null}},uploadThumbnail:async(e,s)=>{let t=s.name.split(".").pop(),n="".concat(e,".").concat(t),{data:l,error:r}=await a.storage.from("thumbnails").upload(n,s,{upsert:!0});if(r)return{data:null,error:r};let{data:{publicUrl:i}}=a.storage.from("thumbnails").getPublicUrl(n);return{data:i,error:null}},uploadCourseFile:async(e,s)=>{let t=s.name.split(".").pop(),n="".concat(e,"/").concat(Date.now(),".").concat(t),{data:l,error:r}=await a.storage.from("course-files").upload(n,s);if(r)return{data:null,error:r};let{data:{publicUrl:i}}=a.storage.from("course-files").getPublicUrl(n);return{data:i,error:null}}}}},function(e){e.O(0,[699,250,126,971,69,744],function(){return e(e.s=7050)}),_N_E=e.O()}]);