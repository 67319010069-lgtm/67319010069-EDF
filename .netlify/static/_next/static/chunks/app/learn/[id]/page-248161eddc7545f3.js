(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[522],{3467:function(e,s,t){Promise.resolve().then(t.bind(t,2195))},7907:function(e,s,t){"use strict";var r=t(5313);t.o(r,"useParams")&&t.d(s,{useParams:function(){return r.useParams}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})},2195:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var r=t(3827),a=t(4090),l=t(7907),n=t(8792),i=t(4958),c=t(1399);function o(){var e,s;let t=(0,l.useParams)(),o=(0,l.useRouter)(),d=t.id,[u,m]=(0,a.useState)(null),[x,g]=(0,a.useState)(null),[h,p]=(0,a.useState)(null),[f,b]=(0,a.useState)(null),[w,v]=(0,a.useState)(0),[y,j]=(0,a.useState)([]),[N,_]=(0,a.useState)(!1),[k,C]=(0,a.useState)(5),[I,S]=(0,a.useState)(""),[q,P]=(0,a.useState)(!0);(0,a.useEffect)(()=>{O()},[d]);let O=async()=>{var e;let{user:s}=await i.auth.getUser();if(!s){o.push("/auth/login");return}m(s);let{data:t}=await i.db.getCourse(d);g(t);let{data:r}=await i.db.getEnrollment(s.id,d);if(!r){o.push("/courses/".concat(d));return}p(r),j(r.progress||[]),(null==t?void 0:null===(e=t.lessons)||void 0===e?void 0:e.length)>0&&(b(t.lessons[0]),v(0)),P(!1)},U=async()=>{if(!f||y.includes(f.id))return;let e=[...y,f.id];j(e),await i.db.updateProgress(h.id,e),e.length===x.lessons.length&&_(!0)},E=(e,s)=>{b(e),v(s)},R=async()=>{u&&(await i.db.createReview({course_id:d,user_id:u.id,rating:k,comment:I}),_(!1),alert("ขอบคุณสำหรับรีวิว!"))};if(q)return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-2xl text-pink-500",children:"กำลังโหลด..."})});let A=(null==x?void 0:null===(e=x.lessons)||void 0===e?void 0:e.length)>0?y.length/x.lessons.length*100:0;return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-900",children:[(0,r.jsx)("div",{className:"bg-gray-800 border-b border-gray-700",children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(n.default,{href:"/dashboard",className:"flex items-center space-x-2 text-white hover:text-pink-400",children:[(0,r.jsx)(c.x_l,{}),(0,r.jsx)("span",{children:"กลับแดชบอร์ด"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("div",{className:"text-white",children:[(0,r.jsx)("span",{className:"text-sm text-gray-400",children:"ความคืบหน้า: "}),(0,r.jsxs)("span",{className:"font-semibold",children:[Math.round(A),"%"]})]}),(0,r.jsx)("div",{className:"w-32 h-2 bg-gray-700 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-gradient-to-r from-pink-500 to-pink-600",style:{width:"".concat(A,"%")}})})]})]})})}),(0,r.jsxs)("div",{className:"flex h-[calc(100vh-60px)]",children:[(0,r.jsx)("div",{className:"w-80 bg-gray-800 overflow-y-auto border-r border-gray-700",children:(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:null==x?void 0:x.title}),(0,r.jsx)("div",{className:"space-y-2",children:null==x?void 0:null===(s=x.lessons)||void 0===s?void 0:s.map((e,s)=>{let t=y.includes(e.id),a=(null==f?void 0:f.id)===e.id;return(0,r.jsx)("button",{onClick:()=>E(e,s),className:"w-full text-left p-3 rounded-lg transition-all ".concat(a?"bg-pink-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center ".concat(t?"bg-green-500":"bg-gray-600"),children:t?(0,r.jsx)(c.l_A,{className:"text-xs text-white"}):(0,r.jsx)("span",{className:"text-xs text-white",children:s+1})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium line-clamp-1",children:e.title}),(0,r.jsx)("div",{className:"text-xs opacity-75",children:e.duration||"N/A"})]})]})})},e.id)})})]})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto bg-gray-900",children:(0,r.jsx)("div",{className:"container mx-auto px-6 py-8 max-w-5xl",children:f&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-white mb-6",children:f.title}),"video"===f.type&&f.url&&(0,r.jsx)("div",{className:"mb-6 bg-black rounded-lg overflow-hidden",children:(0,r.jsxs)("video",{controls:!0,className:"w-full",style:{maxHeight:"500px"},children:[(0,r.jsx)("source",{src:f.url,type:"video/mp4"}),"Your browser does not support the video tag."]},f.id)}),"text"===f.type&&f.content&&(0,r.jsx)("div",{className:"mb-6 bg-gray-800 p-6 rounded-lg text-gray-300 whitespace-pre-wrap",children:f.content}),"pdf"===f.type&&f.url&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("iframe",{src:f.url,className:"w-full h-[600px] rounded-lg",title:f.title}),(0,r.jsx)("a",{href:f.url,target:"_blank",rel:"noopener noreferrer",className:"inline-block mt-4 px-6 py-3 bg-pink-600 text-white rounded-lg hover:bg-pink-700",children:"ดาวน์โหลด PDF"})]}),"audio"===f.type&&f.url&&(0,r.jsx)("div",{className:"mb-6 bg-gray-800 p-6 rounded-lg",children:(0,r.jsxs)("audio",{controls:!0,className:"w-full",children:[(0,r.jsx)("source",{src:f.url,type:"audio/mpeg"}),"Your browser does not support the audio tag."]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("button",{onClick:()=>{if(w>0){let e=w-1;b(x.lessons[e]),v(e)}},disabled:0===w,className:"px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[(0,r.jsx)(c.x_l,{}),(0,r.jsx)("span",{children:"บทก่อนหน้า"})]}),!y.includes(f.id)&&(0,r.jsxs)("button",{onClick:U,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2",children:[(0,r.jsx)(c.l_A,{}),(0,r.jsx)("span",{children:"ทำเสร็จแล้ว"})]}),(0,r.jsxs)("button",{onClick:()=>{if(w<x.lessons.length-1){let e=w+1;b(x.lessons[e]),v(e)}},disabled:w===x.lessons.length-1,className:"px-6 py-3 bg-pink-600 text-white rounded-lg hover:bg-pink-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[(0,r.jsx)("span",{children:"บทถัดไป"}),(0,r.jsx)(c.Z1Y,{})]})]}),N&&(0,r.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-2xl font-bold text-white mb-4",children:"\uD83C\uDF89 ยินดีด้วย! คุณเรียนจบแล้ว"}),(0,r.jsx)("p",{className:"text-gray-300 mb-4",children:"ช่วยรีวิวคอร์สนี้หน่อยได้ไหม?"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-white mb-2",children:"ให้คะแนน"}),(0,r.jsx)("div",{className:"flex space-x-2",children:[1,2,3,4,5].map(e=>(0,r.jsx)("button",{onClick:()=>C(e),className:"text-3xl",children:(0,r.jsx)(c.QJe,{className:e<=k?"text-yellow-500":"text-gray-600"})},e))})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-white mb-2",children:"ความคิดเห็น (ไม่บังคับ)"}),(0,r.jsx)("textarea",{value:I,onChange:e=>S(e.target.value),rows:4,className:"w-full px-4 py-3 bg-gray-700 text-white border border-gray-600 rounded-lg focus:ring-2 focus:ring-pink-500",placeholder:"แบ่งปันประสบการณ์ของคุณ..."})]}),(0,r.jsx)("button",{onClick:R,className:"px-6 py-3 bg-pink-600 text-white rounded-lg hover:bg-pink-700 font-semibold",children:"ส่งรีวิว"})]})]})})})]})]})}},4958:function(e,s,t){"use strict";t.r(s),t.d(s,{auth:function(){return a},db:function(){return l},storage:function(){return n},supabase:function(){return r}});let r=(0,t(7688).eI)("https://ctnmxbhrlqcboztdumgb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0bm14YmhybHFjYm96dGR1bWdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NTA0MzgsImV4cCI6MjA4NjMyNjQzOH0.CBikuMmopGp_wOQvlVNIQXuBQ-dQ7DysT05tpgA156E"),a={signUp:async function(e,s,t){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"student",{data:l,error:n}=await r.auth.signUp({email:e,password:s,options:{data:{full_name:t,role:a,password:s}}});return{data:l,error:n}},signIn:async(e,s)=>{let{data:t,error:a}=await r.auth.signInWithPassword({email:e,password:s});return{data:t,error:a}},signOut:async()=>{let{error:e}=await r.auth.signOut();return{error:e}},getSession:async()=>{let{data:{session:e},error:s}=await r.auth.getSession();return{session:e,error:s}},getUser:async()=>{let{data:{user:e},error:s}=await r.auth.getUser();return{user:e,error:s}}},l={getProfile:async e=>{let{data:s,error:t}=await r.from("profiles").select("*").eq("id",e).single();return{data:s,error:t}},updateProfile:async(e,s)=>{let{data:t,error:a}=await r.from("profiles").update(s).eq("id",e).select().single();return{data:t,error:a}},getCourses:async e=>{let s=r.from("courses").select("\n      *,\n      instructor:profiles!instructor_id(full_name, avatar_url),\n      lessons(id),\n      reviews(rating)\n    ");(null==e?void 0:e.published)!==void 0&&(s=s.eq("published",e.published)),(null==e?void 0:e.category)&&(s=s.eq("category",e.category)),(null==e?void 0:e.search)&&(s=s.ilike("title","%".concat(e.search,"%")));let{data:t,error:a}=await s.order("created_at",{ascending:!1});return{data:t,error:a}},getCourse:async e=>{let{data:s,error:t}=await r.from("courses").select("\n        *,\n        instructor:profiles!instructor_id(full_name, avatar_url, email),\n        lessons(*),\n        reviews(id, rating, comment, created_at, user:profiles(full_name, avatar_url))\n      ").eq("id",e).single();return{data:s,error:t}},createCourse:async e=>{let{data:s,error:t}=await r.from("courses").insert(e).select().single();return{data:s,error:t}},updateCourse:async(e,s)=>{let{data:t,error:a}=await r.from("courses").update({...s,updated_at:new Date().toISOString()}).eq("id",e).select().single();return{data:t,error:a}},deleteCourse:async e=>{let{error:s}=await r.from("courses").delete().eq("id",e);return{error:s}},createLesson:async e=>{let{data:s,error:t}=await r.from("lessons").insert(e).select().single();return{data:s,error:t}},updateLesson:async(e,s)=>{let{data:t,error:a}=await r.from("lessons").update(s).eq("id",e).select().single();return{data:t,error:a}},deleteLesson:async e=>{let{error:s}=await r.from("lessons").delete().eq("id",e);return{error:s}},getEnrollment:async(e,s)=>{let{data:t,error:a}=await r.from("enrollments").select("*").eq("user_id",e).eq("course_id",s).single();return{data:t,error:a}},getUserEnrollments:async e=>{let{data:s,error:t}=await r.from("enrollments").select("\n        *,\n        course:courses(*, instructor:profiles!instructor_id(full_name), lessons(id))\n      ").eq("user_id",e).order("enrolled_at",{ascending:!1});return{data:s,error:t}},createEnrollment:async(e,s)=>{let{data:t,error:a}=await r.from("enrollments").insert({user_id:e,course_id:s}).select().single();return{data:t,error:a}},updateProgress:async(e,s)=>{let{data:t,error:a}=await r.from("enrollments").update({progress:s}).eq("id",e).select().single();return{data:t,error:a}},createReview:async e=>{let{data:s,error:t}=await r.from("reviews").insert(e).select().single();return{data:s,error:t}},updateReview:async(e,s)=>{let{data:t,error:a}=await r.from("reviews").update({...s,updated_at:new Date().toISOString()}).eq("id",e).select().single();return{data:t,error:a}},getUserReview:async(e,s)=>{let{data:t,error:a}=await r.from("reviews").select("*").eq("user_id",e).eq("course_id",s).single();return{data:t,error:a}}},n={uploadAvatar:async(e,s)=>{let t=s.name.split(".").pop(),a="".concat(e,".").concat(t),{data:l,error:n}=await r.storage.from("avatars").upload(a,s,{upsert:!0});if(n)return{data:null,error:n};let{data:{publicUrl:i}}=r.storage.from("avatars").getPublicUrl(a);return{data:i,error:null}},uploadThumbnail:async(e,s)=>{let t=s.name.split(".").pop(),a="".concat(e,".").concat(t),{data:l,error:n}=await r.storage.from("thumbnails").upload(a,s,{upsert:!0});if(n)return{data:null,error:n};let{data:{publicUrl:i}}=r.storage.from("thumbnails").getPublicUrl(a);return{data:i,error:null}},uploadCourseFile:async(e,s)=>{let t=s.name.split(".").pop(),a="".concat(e,"/").concat(Date.now(),".").concat(t),{data:l,error:n}=await r.storage.from("course-files").upload(a,s);if(n)return{data:null,error:n};let{data:{publicUrl:i}}=r.storage.from("course-files").getPublicUrl(a);return{data:i,error:null}}}}},function(e){e.O(0,[699,250,126,971,69,744],function(){return e(e.s=3467)}),_N_E=e.O()}]);