(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{4563:function(e,t,s){Promise.resolve().then(s.bind(s,7736))},7907:function(e,t,s){"use strict";var r=s(5313);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},7736:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var r=s(3827),a=s(4090),l=s(7907),n=s(8792),i=s(4958),o=s(1399);function d(){let e=(0,l.useRouter)(),[t,s]=(0,a.useState)(null),[d,c]=(0,a.useState)(null),[u,m]=(0,a.useState)([]),[x,h]=(0,a.useState)([]),[p,f]=(0,a.useState)(!0);(0,a.useEffect)(()=>{g()},[]);let g=async()=>{let{user:t}=await i.auth.getUser();if(!t){e.push("/auth/login");return}s(t);let{data:r}=await i.db.getProfile(t.id);c(r),(null==r?void 0:r.role)==="instructor"?b(t.id):v(t.id)},b=async e=>{let{data:t}=await i.db.getCourses({published:void 0});m((null==t?void 0:t.filter(t=>t.instructor_id===e))||[]),f(!1)},v=async e=>{let{data:t}=await i.db.getUserEnrollments(e);h(t||[]),f(!1)},w=async()=>{await i.auth.signOut(),e.push("/")};return p?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-pink-100 flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-2xl text-pink-600 font-semibold animate-pulse",children:"กำลังโหลด..."})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-pink-100 text-gray-900",children:[(0,r.jsx)("nav",{className:"glass sticky top-0 z-50 border-b border-white/40 shadow-sm",children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(n.default,{href:"/",className:"flex items-center space-x-2",children:[(0,r.jsx)(o.nGB,{className:"text-3xl text-pink-500"}),(0,r.jsx)("span",{className:"text-2xl font-bold bg-gradient-to-r from-pink-500 to-pink-700 bg-clip-text text-transparent",children:"Eduflow"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)(n.default,{href:"/courses",className:"px-4 py-2 text-gray-800 hover:text-pink-600 font-medium transition-colors",children:"คอร์สเรียน"}),(0,r.jsxs)(n.default,{href:"/profile",className:"px-4 py-2 text-gray-800 hover:text-pink-600 font-medium transition-colors",children:[(0,r.jsx)(o.Xws,{className:"inline mr-2"}),"โปรไฟล์"]}),(0,r.jsxs)("button",{onClick:w,className:"px-4 py-2 text-red-600 hover:text-red-700 font-medium transition-colors",children:[(0,r.jsx)(o.fHX,{className:"inline mr-2"}),"ออกจากระบบ"]})]})]})})}),(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("h1",{className:"text-4xl font-bold mb-2 text-gray-900",children:["สวัสดี, ",(0,r.jsx)("span",{className:"text-pink-600",children:null==d?void 0:d.full_name}),"!"]}),(0,r.jsx)("p",{className:"text-gray-700 text-lg",children:(null==d?void 0:d.role)==="instructor"?"จัดการคอร์สเรียนของคุณ":"เรียนรู้ไปกับเรา"})]}),(null==d?void 0:d.role)==="instructor"&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"คอร์สของฉัน"}),(0,r.jsxs)(n.default,{href:"/instructor/create-course",className:"px-6 py-3 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-xl hover:shadow-lg hover:scale-105 font-medium flex items-center space-x-2 transition-all",children:[(0,r.jsx)(o.wEH,{}),(0,r.jsx)("span",{children:"สร้างคอร์สใหม่"})]})]}),0===u.length?(0,r.jsxs)("div",{className:"glass p-12 rounded-3xl text-center border border-white/50 shadow-md",children:[(0,r.jsx)(o.Mp$,{className:"text-6xl text-pink-300 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4 text-lg",children:"คุณยังไม่มีคอร์สเรียน"}),(0,r.jsx)(n.default,{href:"/instructor/create-course",className:"inline-block px-6 py-3 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-xl hover:shadow-lg hover:scale-105 font-medium transition-all",children:"สร้างคอร์สแรกของคุณ"})]}):(0,r.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(e=>{var t;return(0,r.jsxs)("div",{className:"glass p-6 rounded-2xl hover:shadow-xl hover:scale-[1.02] transition-all border border-white/60 bg-white/60",children:[e.thumbnail&&(0,r.jsx)("div",{className:"relative h-48 mb-4 rounded-xl overflow-hidden shadow-sm",children:(0,r.jsx)("img",{src:e.thumbnail,alt:e.title,className:"w-full h-full object-cover"})}),(0,r.jsx)("h3",{className:"text-xl font-bold mb-2 text-gray-900",children:e.title}),(0,r.jsx)("p",{className:"text-gray-600 mb-4 line-clamp-2 text-sm",children:e.description}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold ".concat(e.published?"bg-green-100 text-green-700 border border-green-200":"bg-yellow-100 text-yellow-700 border border-yellow-200"),children:e.published?"เผยแพร่แล้ว":"แบบร่าง"}),(0,r.jsxs)("span",{className:"text-gray-500 text-sm font-medium",children:[(null===(t=e.lessons)||void 0===t?void 0:t.length)||0," บทเรียน"]})]}),(0,r.jsx)(n.default,{href:"/instructor/edit-course/".concat(e.id),className:"block w-full text-center px-4 py-2.5 bg-white border border-pink-200 text-pink-600 rounded-xl hover:bg-pink-50 hover:border-pink-300 font-semibold transition-colors",children:"แก้ไขคอร์ส"})]},e.id)})})]}),(null==d?void 0:d.role)==="student"&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:"คอร์สของฉัน"}),0===x.length?(0,r.jsxs)("div",{className:"glass p-12 rounded-3xl text-center border border-white/50 shadow-md",children:[(0,r.jsx)(o.Mp$,{className:"text-6xl text-pink-300 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4 text-lg",children:"คุณยังไม่ได้ลงทะเบียนคอร์สใดๆ"}),(0,r.jsx)(n.default,{href:"/courses",className:"inline-block px-6 py-3 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-xl hover:shadow-lg hover:scale-105 font-medium transition-all",children:"เลือกคอร์สเรียน"})]}):(0,r.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(e=>{var t,s,a;let l=e.course,i=(null===(t=l.lessons)||void 0===t?void 0:t.length)||0,o=(null===(s=e.progress)||void 0===s?void 0:s.length)||0,d=i>0?o/i*100:0;return(0,r.jsxs)("div",{className:"glass p-6 rounded-2xl hover:shadow-xl hover:scale-[1.02] transition-all border border-white/60 bg-white/60",children:[l.thumbnail&&(0,r.jsx)("div",{className:"relative h-48 mb-4 rounded-xl overflow-hidden shadow-sm",children:(0,r.jsx)("img",{src:l.thumbnail,alt:l.title,className:"w-full h-full object-cover"})}),(0,r.jsx)("h3",{className:"text-xl font-bold mb-2 text-gray-900",children:l.title}),(0,r.jsxs)("p",{className:"text-gray-600 mb-4 text-sm font-medium",children:["โดย ",null===(a=l.instructor)||void 0===a?void 0:a.full_name]}),(0,r.jsxs)("div",{className:"mb-5",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-1 font-medium",children:[(0,r.jsx)("span",{children:"ความคืบหน้า"}),(0,r.jsxs)("span",{className:"text-pink-600",children:[Math.round(d),"%"]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 overflow-hidden",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-pink-400 to-pink-600 h-full rounded-full transition-all duration-500",style:{width:"".concat(d,"%")}})})]}),(0,r.jsx)(n.default,{href:"/learn/".concat(l.id),className:"block w-full text-center px-4 py-2.5 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-xl hover:shadow-md hover:scale-[1.02] font-semibold transition-all",children:d>0?"เรียนต่อ":"เริ่มเรียน"})]},e.id)})})]})]})]})}},4958:function(e,t,s){"use strict";s.r(t),s.d(t,{auth:function(){return a},db:function(){return l},storage:function(){return n},supabase:function(){return r}});let r=(0,s(7688).eI)("https://ctnmxbhrlqcboztdumgb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0bm14YmhybHFjYm96dGR1bWdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NTA0MzgsImV4cCI6MjA4NjMyNjQzOH0.CBikuMmopGp_wOQvlVNIQXuBQ-dQ7DysT05tpgA156E"),a={signUp:async function(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"student",{data:l,error:n}=await r.auth.signUp({email:e,password:t,options:{data:{full_name:s,role:a,password:t}}});return{data:l,error:n}},signIn:async(e,t)=>{let{data:s,error:a}=await r.auth.signInWithPassword({email:e,password:t});return{data:s,error:a}},signOut:async()=>{let{error:e}=await r.auth.signOut();return{error:e}},getSession:async()=>{let{data:{session:e},error:t}=await r.auth.getSession();return{session:e,error:t}},getUser:async()=>{let{data:{user:e},error:t}=await r.auth.getUser();return{user:e,error:t}}},l={getProfile:async e=>{let{data:t,error:s}=await r.from("profiles").select("*").eq("id",e).single();return{data:t,error:s}},updateProfile:async(e,t)=>{let{data:s,error:a}=await r.from("profiles").update(t).eq("id",e).select().single();return{data:s,error:a}},getCourses:async e=>{let t=r.from("courses").select("\n      *,\n      instructor:profiles!instructor_id(full_name, avatar_url),\n      lessons(id),\n      reviews(rating)\n    ");(null==e?void 0:e.published)!==void 0&&(t=t.eq("published",e.published)),(null==e?void 0:e.category)&&(t=t.eq("category",e.category)),(null==e?void 0:e.search)&&(t=t.ilike("title","%".concat(e.search,"%")));let{data:s,error:a}=await t.order("created_at",{ascending:!1});return{data:s,error:a}},getCourse:async e=>{let{data:t,error:s}=await r.from("courses").select("\n        *,\n        instructor:profiles!instructor_id(full_name, avatar_url, email),\n        lessons(*),\n        reviews(id, rating, comment, created_at, user:profiles(full_name, avatar_url))\n      ").eq("id",e).single();return{data:t,error:s}},createCourse:async e=>{let{data:t,error:s}=await r.from("courses").insert(e).select().single();return{data:t,error:s}},updateCourse:async(e,t)=>{let{data:s,error:a}=await r.from("courses").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();return{data:s,error:a}},deleteCourse:async e=>{let{error:t}=await r.from("courses").delete().eq("id",e);return{error:t}},createLesson:async e=>{let{data:t,error:s}=await r.from("lessons").insert(e).select().single();return{data:t,error:s}},updateLesson:async(e,t)=>{let{data:s,error:a}=await r.from("lessons").update(t).eq("id",e).select().single();return{data:s,error:a}},deleteLesson:async e=>{let{error:t}=await r.from("lessons").delete().eq("id",e);return{error:t}},getEnrollment:async(e,t)=>{let{data:s,error:a}=await r.from("enrollments").select("*").eq("user_id",e).eq("course_id",t).single();return{data:s,error:a}},getUserEnrollments:async e=>{let{data:t,error:s}=await r.from("enrollments").select("\n        *,\n        course:courses(*, instructor:profiles!instructor_id(full_name), lessons(id))\n      ").eq("user_id",e).order("enrolled_at",{ascending:!1});return{data:t,error:s}},createEnrollment:async(e,t)=>{let{data:s,error:a}=await r.from("enrollments").insert({user_id:e,course_id:t}).select().single();return{data:s,error:a}},updateProgress:async(e,t)=>{let{data:s,error:a}=await r.from("enrollments").update({progress:t}).eq("id",e).select().single();return{data:s,error:a}},createReview:async e=>{let{data:t,error:s}=await r.from("reviews").insert(e).select().single();return{data:t,error:s}},updateReview:async(e,t)=>{let{data:s,error:a}=await r.from("reviews").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();return{data:s,error:a}},getUserReview:async(e,t)=>{let{data:s,error:a}=await r.from("reviews").select("*").eq("user_id",e).eq("course_id",t).single();return{data:s,error:a}}},n={uploadAvatar:async(e,t)=>{let s=t.name.split(".").pop(),a="".concat(e,".").concat(s),{data:l,error:n}=await r.storage.from("avatars").upload(a,t,{upsert:!0});if(n)return{data:null,error:n};let{data:{publicUrl:i}}=r.storage.from("avatars").getPublicUrl(a);return{data:i,error:null}},uploadThumbnail:async(e,t)=>{let s=t.name.split(".").pop(),a="".concat(e,".").concat(s),{data:l,error:n}=await r.storage.from("thumbnails").upload(a,t,{upsert:!0});if(n)return{data:null,error:n};let{data:{publicUrl:i}}=r.storage.from("thumbnails").getPublicUrl(a);return{data:i,error:null}},uploadCourseFile:async(e,t)=>{let s=t.name.split(".").pop(),a="".concat(e,"/").concat(Date.now(),".").concat(s),{data:l,error:n}=await r.storage.from("course-files").upload(a,t);if(n)return{data:null,error:n};let{data:{publicUrl:i}}=r.storage.from("course-files").getPublicUrl(a);return{data:i,error:null}}}}},function(e){e.O(0,[699,250,126,971,69,744],function(){return e(e.s=4563)}),_N_E=e.O()}]);