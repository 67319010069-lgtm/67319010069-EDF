(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{1210:function(e,t,r){Promise.resolve().then(r.bind(r,2509))},7907:function(e,t,r){"use strict";var s=r(5313);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},2509:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var s=r(3827),a=r(4090),l=r(7907),n=r(8792),i=r(4958),o=r(1399);function c(){let e=(0,l.useRouter)(),[t,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[m,x]=(0,a.useState)(!0),[f,p]=(0,a.useState)(!1),[h,g]=(0,a.useState)(""),[v,b]=(0,a.useState)(""),[w,y]=(0,a.useState)(!1),j=Array.from({length:20},(e,t)=>"https://api.dicebear.com/7.x/avataaars/svg?seed=Felix".concat(t,"&backgroundColor=b6e3f4"));(0,a.useEffect)(()=>{N()},[]);let N=async()=>{try{let{user:t}=await i.auth.getUser();if(!t){e.push("/auth/login");return}c(t);let{data:r}=await i.db.getProfile(t.id);u(r),g((null==r?void 0:r.full_name)||""),b((null==r?void 0:r.avatar_url)||"")}catch(e){console.error("Error loading profile:",e)}finally{x(!1)}},k=async()=>{await i.auth.signOut(),e.push("/auth/login")},_=async e=>{if(!e.target.files||0===e.target.files.length)return;y(!0);let s=e.target.files[0];try{let{data:e,error:a}=await Promise.resolve().then(r.bind(r,4958)).then(e=>e.storage.uploadAvatar(t.id,s));if(a)throw a;e&&b(e)}catch(e){console.error("Error uploading avatar:",e),alert("เกิดข้อผิดพลาดในการอัปโหลดรูปภาพ")}finally{y(!1)}},C=async()=>{x(!0);try{let{error:e}=await i.db.updateProfile(t.id,{full_name:h,avatar_url:v});if(e)throw e;u({...d,full_name:h,avatar_url:v}),p(!1),alert("บันทึกข้อมูลเรียบร้อยแล้ว")}catch(e){console.error("Error updating profile:",e),alert("เกิดข้อผิดพลาดในการบันทึกข้อมูล")}finally{x(!1)}};return m?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-pink-100 flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-2xl text-pink-500 font-semibold animate-pulse",children:"กำลังโหลดข้อมูล..."})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-pink-100",children:[(0,s.jsx)("nav",{className:"glass sticky top-0 z-50 border-b border-white/20",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(n.default,{href:"/",className:"flex items-center space-x-2",children:[(0,s.jsx)(o.nGB,{className:"text-3xl text-pink-500"}),(0,s.jsx)("span",{className:"text-2xl font-bold bg-gradient-to-r from-pink-400 to-pink-600 bg-clip-text text-transparent",children:"Eduflow"})]}),(0,s.jsxs)(n.default,{href:"/dashboard",className:"px-4 py-2 text-gray-700 hover:text-pink-500 font-medium flex items-center space-x-2",children:[(0,s.jsx)(o.x_l,{}),(0,s.jsx)("span",{children:"กลับแดชบอร์ด"})]})]})})}),(0,s.jsx)("div",{className:"container mx-auto px-4 py-12",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,s.jsxs)("div",{className:"glass p-8 rounded-3xl shadow-xl border border-white/50 relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute -top-20 -right-20 w-64 h-64 bg-pink-200 rounded-full opacity-20 blur-3xl"}),(0,s.jsx)("div",{className:"absolute -bottom-20 -left-20 w-64 h-64 bg-purple-200 rounded-full opacity-20 blur-3xl"}),(0,s.jsx)("div",{className:"relative z-10",children:f?(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-8",children:"แก้ไขข้อมูลส่วนตัว"}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-8 w-full",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsxs)("div",{className:"w-40 h-40 bg-gradient-to-br from-pink-100 to-pink-200 rounded-full flex items-center justify-center mb-4 shadow-inner ring-4 ring-pink-400 overflow-hidden relative group",children:[v?(0,s.jsx)("img",{src:v,alt:"Preview",className:"w-full h-full object-cover"}):(0,s.jsx)(o.Xws,{className:"text-6xl text-pink-400"}),w&&(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center text-white text-sm",children:"อัปโหลด..."})]}),(0,s.jsx)("div",{className:"flex flex-col gap-3 w-full max-w-xs",children:(0,s.jsxs)("label",{className:"cursor-pointer py-2 px-4 bg-pink-100 text-pink-600 rounded-lg hover:bg-pink-200 text-center font-medium transition-colors",children:[(0,s.jsx)("span",{children:"อัปโหลดรูปภาพ"}),(0,s.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:_,disabled:w})]})}),(0,s.jsxs)("div",{className:"mt-6 w-full",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-500 mb-3 text-center",children:"หรือเลือกรูปการ์ตูนน่ารักๆ"}),(0,s.jsx)("div",{className:"grid grid-cols-5 gap-2",children:j.map((e,t)=>(0,s.jsx)("button",{onClick:()=>b(e),className:"w-12 h-12 rounded-full overflow-hidden border-2 transition-all hover:scale-110 ".concat(v===e?"border-pink-500 ring-2 ring-pink-200":"border-transparent hover:border-gray-300"),children:(0,s.jsx)("img",{src:e,alt:"Avatar ".concat(t+1),className:"w-full h-full"})},t))})]})]}),(0,s.jsx)("div",{className:"flex flex-col justify-center",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ชื่อ - นามสกุล"}),(0,s.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-400 focus:border-transparent text-gray-900",placeholder:"กรอกชื่อ-นามสกุลของคุณ"})]}),(0,s.jsxs)("div",{className:"pt-4 flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>{p(!1),g((null==d?void 0:d.full_name)||""),b((null==d?void 0:d.avatar_url)||"")},className:"flex-1 py-3 px-4 border border-gray-300 text-gray-600 rounded-xl hover:bg-gray-50 font-medium",children:"ยกเลิก"}),(0,s.jsx)("button",{onClick:C,className:"flex-1 py-3 px-4 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all font-medium",children:"บันทึกข้อมูล"})]})]})})]})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-40 h-40 bg-gradient-to-br from-pink-100 to-pink-200 rounded-full flex items-center justify-center mb-6 shadow-inner ring-4 ring-white overflow-hidden",children:(null==d?void 0:d.avatar_url)?(0,s.jsx)("img",{src:d.avatar_url,alt:d.full_name,className:"w-full h-full object-cover"}):(0,s.jsx)(o.Xws,{className:"text-6xl text-pink-400"})}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:(null==d?void 0:d.full_name)||"ผู้ใช้งาน"}),(0,s.jsx)("span",{className:"px-4 py-1 rounded-full text-sm font-semibold mb-8 ".concat((null==d?void 0:d.role)==="instructor"?"bg-purple-100 text-purple-600":"bg-pink-100 text-pink-600"),children:(null==d?void 0:d.role)==="instructor"?"ผู้สอน":"นักเรียน"}),(0,s.jsxs)("div",{className:"w-full max-w-md space-y-4 bg-white/50 p-6 rounded-2xl mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center p-3 hover:bg-white rounded-xl transition-colors",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center text-pink-500 mr-4",children:(0,s.jsx)(o.SRX,{})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"อีเมล"}),(0,s.jsx)("p",{className:"font-medium text-gray-800",children:null==t?void 0:t.email})]})]}),(0,s.jsxs)("div",{className:"flex items-center p-3 hover:bg-white rounded-xl transition-colors",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center text-pink-500 mr-4",children:(0,s.jsx)(o.pPV,{})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"เริ่มใช้งานเมื่อ"}),(0,s.jsx)("p",{className:"font-medium text-gray-800",children:new Date(null==t?void 0:t.created_at).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"})})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-4 w-full max-w-md",children:[(0,s.jsxs)("button",{onClick:()=>p(!0),className:"flex-1 py-3 px-4 bg-white border border-gray-200 text-gray-700 rounded-xl hover:bg-gray-50 hover:border-pink-300 hover:text-pink-500 transition-all font-medium flex items-center justify-center gap-2 group",children:[(0,s.jsx)(o.fmQ,{className:"group-hover:scale-110 transition-transform"}),(0,s.jsx)("span",{children:"แก้ไขข้อมูลส่วนตัว"})]}),(0,s.jsxs)("button",{onClick:k,className:"flex-1 py-3 px-4 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all font-medium flex items-center justify-center gap-2",children:[(0,s.jsx)(o.fHX,{}),(0,s.jsx)("span",{children:"ออกจากระบบ"})]})]})]})})]})})})]})}},4958:function(e,t,r){"use strict";r.r(t),r.d(t,{auth:function(){return a},db:function(){return l},storage:function(){return n},supabase:function(){return s}});let s=(0,r(7688).eI)("https://ctnmxbhrlqcboztdumgb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0bm14YmhybHFjYm96dGR1bWdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NTA0MzgsImV4cCI6MjA4NjMyNjQzOH0.CBikuMmopGp_wOQvlVNIQXuBQ-dQ7DysT05tpgA156E"),a={signUp:async function(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"student",{data:l,error:n}=await s.auth.signUp({email:e,password:t,options:{data:{full_name:r,role:a,password:t}}});return{data:l,error:n}},signIn:async(e,t)=>{let{data:r,error:a}=await s.auth.signInWithPassword({email:e,password:t});return{data:r,error:a}},signOut:async()=>{let{error:e}=await s.auth.signOut();return{error:e}},getSession:async()=>{let{data:{session:e},error:t}=await s.auth.getSession();return{session:e,error:t}},getUser:async()=>{let{data:{user:e},error:t}=await s.auth.getUser();return{user:e,error:t}}},l={getProfile:async e=>{let{data:t,error:r}=await s.from("profiles").select("*").eq("id",e).single();return{data:t,error:r}},updateProfile:async(e,t)=>{let{data:r,error:a}=await s.from("profiles").update(t).eq("id",e).select().single();return{data:r,error:a}},getCourses:async e=>{let t=s.from("courses").select("\n      *,\n      instructor:profiles!instructor_id(full_name, avatar_url),\n      lessons(id),\n      reviews(rating)\n    ");(null==e?void 0:e.published)!==void 0&&(t=t.eq("published",e.published)),(null==e?void 0:e.category)&&(t=t.eq("category",e.category)),(null==e?void 0:e.search)&&(t=t.ilike("title","%".concat(e.search,"%")));let{data:r,error:a}=await t.order("created_at",{ascending:!1});return{data:r,error:a}},getCourse:async e=>{let{data:t,error:r}=await s.from("courses").select("\n        *,\n        instructor:profiles!instructor_id(full_name, avatar_url, email),\n        lessons(*),\n        reviews(id, rating, comment, created_at, user:profiles(full_name, avatar_url))\n      ").eq("id",e).single();return{data:t,error:r}},createCourse:async e=>{let{data:t,error:r}=await s.from("courses").insert(e).select().single();return{data:t,error:r}},updateCourse:async(e,t)=>{let{data:r,error:a}=await s.from("courses").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();return{data:r,error:a}},deleteCourse:async e=>{let{error:t}=await s.from("courses").delete().eq("id",e);return{error:t}},createLesson:async e=>{let{data:t,error:r}=await s.from("lessons").insert(e).select().single();return{data:t,error:r}},updateLesson:async(e,t)=>{let{data:r,error:a}=await s.from("lessons").update(t).eq("id",e).select().single();return{data:r,error:a}},deleteLesson:async e=>{let{error:t}=await s.from("lessons").delete().eq("id",e);return{error:t}},getEnrollment:async(e,t)=>{let{data:r,error:a}=await s.from("enrollments").select("*").eq("user_id",e).eq("course_id",t).single();return{data:r,error:a}},getUserEnrollments:async e=>{let{data:t,error:r}=await s.from("enrollments").select("\n        *,\n        course:courses(*, instructor:profiles!instructor_id(full_name), lessons(id))\n      ").eq("user_id",e).order("enrolled_at",{ascending:!1});return{data:t,error:r}},createEnrollment:async(e,t)=>{let{data:r,error:a}=await s.from("enrollments").insert({user_id:e,course_id:t}).select().single();return{data:r,error:a}},updateProgress:async(e,t)=>{let{data:r,error:a}=await s.from("enrollments").update({progress:t}).eq("id",e).select().single();return{data:r,error:a}},createReview:async e=>{let{data:t,error:r}=await s.from("reviews").insert(e).select().single();return{data:t,error:r}},updateReview:async(e,t)=>{let{data:r,error:a}=await s.from("reviews").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();return{data:r,error:a}},getUserReview:async(e,t)=>{let{data:r,error:a}=await s.from("reviews").select("*").eq("user_id",e).eq("course_id",t).single();return{data:r,error:a}}},n={uploadAvatar:async(e,t)=>{let r=t.name.split(".").pop(),a="".concat(e,".").concat(r),{data:l,error:n}=await s.storage.from("avatars").upload(a,t,{upsert:!0});if(n)return{data:null,error:n};let{data:{publicUrl:i}}=s.storage.from("avatars").getPublicUrl(a);return{data:i,error:null}},uploadThumbnail:async(e,t)=>{let r=t.name.split(".").pop(),a="".concat(e,".").concat(r),{data:l,error:n}=await s.storage.from("thumbnails").upload(a,t,{upsert:!0});if(n)return{data:null,error:n};let{data:{publicUrl:i}}=s.storage.from("thumbnails").getPublicUrl(a);return{data:i,error:null}},uploadCourseFile:async(e,t)=>{let r=t.name.split(".").pop(),a="".concat(e,"/").concat(Date.now(),".").concat(r),{data:l,error:n}=await s.storage.from("course-files").upload(a,t);if(n)return{data:null,error:n};let{data:{publicUrl:i}}=s.storage.from("course-files").getPublicUrl(a);return{data:i,error:null}}}}},function(e){e.O(0,[699,250,126,971,69,744],function(){return e(e.s=1210)}),_N_E=e.O()}]);