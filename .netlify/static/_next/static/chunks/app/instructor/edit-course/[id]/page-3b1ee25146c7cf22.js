(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[475],{6476:function(e,t,r){Promise.resolve().then(r.bind(r,3025))},7907:function(e,t,r){"use strict";var s=r(5313);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},3025:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var s=r(3827),a=r(4090),l=r(7907),n=r(8792),i=r(4958),o=r(1399);let d=["โปรแกรมมิ่ง","ธุรกิจ","ดิจิทัลมาร์เก็ตติ้ง","ดีไซน์","ภาษา","อื่นๆ"],u=[{value:"video",label:"วิดีโอ"},{value:"text",label:"ข้อความ"},{value:"pdf",label:"PDF"},{value:"audio",label:"เสียง"}];function c(){let e=(0,l.useRouter)(),t=(0,l.useParams)().id,[r,c]=(0,a.useState)(null),[m,p]=(0,a.useState)(!0),[x,g]=(0,a.useState)(!1),[h,f]=(0,a.useState)(""),[b,y]=(0,a.useState)(""),[v,j]=(0,a.useState)(""),[w,N]=(0,a.useState)(d[0]),[k,_]=(0,a.useState)(0),[C,S]=(0,a.useState)(""),[I,q]=(0,a.useState)(!1),[P,U]=(0,a.useState)([]),[O,E]=(0,a.useState)([]);(0,a.useEffect)(()=>{R()},[]);let R=async()=>{try{let{user:r}=await i.auth.getUser();if(!r){e.push("/auth/login");return}let{data:s}=await i.db.getProfile(r.id);if((null==s?void 0:s.role)!=="instructor"){e.push("/dashboard");return}c(r);let{data:a,error:l}=await i.db.getCourse(t);if(l)throw l;if(a.instructor_id!==r.id){e.push("/dashboard");return}y(a.title),j(a.description),N(a.category),_(a.price),S(a.thumbnail),q(a.published);let n=(a.lessons||[]).sort((e,t)=>e.order-t.order);U(n.map(e=>({...e,tempId:e.id}))),p(!1)}catch(e){console.error(e),f("ไม่สามารถโหลดข้อมูลคอร์สได้"),p(!1)}},D=(e,t,r)=>{let s=[...P];s[e][t]=r,U(s)},L=e=>{let t=P[e];t.id&&E([...O,t.id]),U(P.filter((t,r)=>r!==e))},z=async r=>{if(r.preventDefault(),g(!0),f(""),!b||!v||!w){f("กรุณากรอกข้อมูลให้ครบถ้วน"),g(!1);return}try{let{error:r}=await i.db.updateCourse(t,{title:b,description:v,category:w,price:k,thumbnail:C,published:I,updated_at:new Date().toISOString()});if(r)throw r;for(let e of O)await i.db.deleteLesson(e);for(let e=0;e<P.length;e++){let r=P[e],s={course_id:t,title:r.title,type:r.type,content:r.content,url:r.url,duration:r.duration,order:e};r.id?await i.db.updateLesson(r.id,s):r.title&&await i.db.createLesson(s)}alert("บันทึกการแก้ไขเรียบร้อยแล้ว"),e.push("/dashboard")}catch(e){f(e.message||"เกิดข้อผิดพลาดในการบันทึก"),g(!1)}};return m?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-pink-100 flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-2xl text-pink-500 font-semibold animate-pulse",children:"กำลังโหลดข้อมูล..."})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 via-white to-pink-100",children:[(0,s.jsx)("nav",{className:"glass sticky top-0 z-50 border-b border-white/20",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(n.default,{href:"/",className:"flex items-center space-x-2",children:[(0,s.jsx)(o.nGB,{className:"text-3xl text-pink-500"}),(0,s.jsx)("span",{className:"text-2xl font-bold bg-gradient-to-r from-pink-400 to-pink-600 bg-clip-text text-transparent",children:"Eduflow"})]}),(0,s.jsxs)(n.default,{href:"/dashboard",className:"px-4 py-2 text-gray-700 hover:text-pink-500 font-medium",children:[(0,s.jsx)(o.x_l,{className:"inline mr-2"}),"กลับ"]})]})})}),(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold",children:"แก้ไขคอร์สเรียน"}),(0,s.jsxs)("button",{type:"button",onClick:()=>{confirm("คุณต้องการลบคอร์สนี้ใช่หรือไม่? การกระทำนี้ไม่สามารถย้อนกลับได้")&&i.db.deleteCourse(t).then(()=>e.push("/dashboard"))},className:"text-red-600 hover:text-red-700 font-medium flex items-center space-x-2 px-4 py-2 border border-red-200 rounded-lg hover:bg-red-50",children:[(0,s.jsx)(o.Xm5,{}),(0,s.jsx)("span",{children:"ลบคอร์ส"})]})]}),h&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:h}),(0,s.jsxs)("form",{onSubmit:z,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"glass p-6 rounded-2xl",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"ข้อมูลคอร์ส"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ชื่อคอร์ส *"}),(0,s.jsx)("input",{type:"text",value:b,onChange:e=>y(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:border-transparent text-gray-900",placeholder:"เช่น การเขียนโปรแกรม Python สำหรับผู้เริ่มต้น",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"คำอธิบาย *"}),(0,s.jsx)("textarea",{value:v,onChange:e=>j(e.target.value),rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:border-transparent text-gray-900",placeholder:"อธิบายเกี่ยวกับคอร์สของคุณ...",required:!0})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"หมวดหมู่ *"}),(0,s.jsx)("select",{value:w,onChange:e=>N(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:border-transparent text-gray-900",children:d.map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ราคา (บาท)"}),(0,s.jsx)("input",{type:"number",value:k,onChange:e=>_(Number(e.target.value)),min:"0",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:border-transparent text-gray-900",placeholder:"0"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL รูปปก"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(o.H3h,{className:"text-gray-400 mt-3"}),(0,s.jsx)("input",{type:"url",value:C,onChange:e=>S(e.target.value),className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-400 focus:border-transparent text-gray-900",placeholder:"https://example.com/image.jpg"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("input",{type:"checkbox",id:"published",checked:I,onChange:e=>q(e.target.checked),className:"w-5 h-5 text-pink-500 rounded focus:ring-pink-400"}),(0,s.jsx)("label",{htmlFor:"published",className:"text-sm font-medium text-gray-700",children:"เผยแพร่คอร์สทันที (ถ้าไม่เลือกจะเป็นแบบร่าง)"})]})]})]}),(0,s.jsxs)("div",{className:"glass p-6 rounded-2xl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"บทเรียน"}),(0,s.jsxs)("button",{type:"button",onClick:()=>{U([...P,{tempId:Date.now(),title:"",type:"video",content:"",url:"",duration:"",order:P.length}])},className:"px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 flex items-center space-x-2",children:[(0,s.jsx)(o.wEH,{}),(0,s.jsx)("span",{children:"เพิ่มบทเรียน"})]})]}),0===P.length&&(0,s.jsx)("p",{className:"text-gray-600 text-center py-8",children:"ยังไม่มีบทเรียน คลิกปุ่มด้านบนเพื่อเพิ่ม"}),(0,s.jsx)("div",{className:"space-y-4",children:P.map((e,t)=>(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,s.jsxs)("h3",{className:"font-semibold",children:["บทเรียนที่ ",t+1]}),(0,s.jsx)("button",{type:"button",onClick:()=>L(t),className:"text-red-600 hover:text-red-700",children:(0,s.jsx)(o.Xm5,{})})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-3",children:[(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"text",value:e.title,onChange:e=>D(t,"title",e.target.value),placeholder:"ชื่อบทเรียน",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900"})}),(0,s.jsx)("div",{children:(0,s.jsx)("select",{value:e.type,onChange:e=>D(t,"type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:u.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})})]}),(0,s.jsx)("div",{className:"mt-3",children:"text"===e.type?(0,s.jsx)("textarea",{value:e.content,onChange:e=>D(t,"content",e.target.value),placeholder:"เนื้อหาบทเรียน",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}):(0,s.jsx)("input",{type:"url",value:e.url,onChange:e=>D(t,"url",e.target.value),placeholder:"URL ของไฟล์ (วิดีโอ, PDF, เสียง)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)("input",{type:"text",value:e.duration,onChange:e=>D(t,"duration",e.target.value),placeholder:"ระยะเวลา (เช่น 10:30)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})})]},e.tempId))})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,s.jsx)(n.default,{href:"/dashboard",className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium",children:"ยกเลิก"}),(0,s.jsxs)("button",{type:"submit",disabled:x,className:"px-6 py-3 bg-gradient-to-r from-pink-400 to-pink-600 text-white rounded-lg hover:shadow-lg hover:scale-105 font-semibold disabled:opacity-50 flex items-center space-x-2",children:[(0,s.jsx)(o.TvB,{}),(0,s.jsx)("span",{children:x?"กำลังบันทึก...":"บันทึกการแก้ไข"})]})]})]})]})]})}},4958:function(e,t,r){"use strict";r.r(t),r.d(t,{auth:function(){return a},db:function(){return l},storage:function(){return n},supabase:function(){return s}});let s=(0,r(7688).eI)("https://ctnmxbhrlqcboztdumgb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0bm14YmhybHFjYm96dGR1bWdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NTA0MzgsImV4cCI6MjA4NjMyNjQzOH0.CBikuMmopGp_wOQvlVNIQXuBQ-dQ7DysT05tpgA156E"),a={signUp:async function(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"student",{data:l,error:n}=await s.auth.signUp({email:e,password:t,options:{data:{full_name:r,role:a,password:t}}});return{data:l,error:n}},signIn:async(e,t)=>{let{data:r,error:a}=await s.auth.signInWithPassword({email:e,password:t});return{data:r,error:a}},signOut:async()=>{let{error:e}=await s.auth.signOut();return{error:e}},getSession:async()=>{let{data:{session:e},error:t}=await s.auth.getSession();return{session:e,error:t}},getUser:async()=>{let{data:{user:e},error:t}=await s.auth.getUser();return{user:e,error:t}}},l={getProfile:async e=>{let{data:t,error:r}=await s.from("profiles").select("*").eq("id",e).single();return{data:t,error:r}},updateProfile:async(e,t)=>{let{data:r,error:a}=await s.from("profiles").update(t).eq("id",e).select().single();return{data:r,error:a}},getCourses:async e=>{let t=s.from("courses").select("\n      *,\n      instructor:profiles!instructor_id(full_name, avatar_url),\n      lessons(id),\n      reviews(rating)\n    ");(null==e?void 0:e.published)!==void 0&&(t=t.eq("published",e.published)),(null==e?void 0:e.category)&&(t=t.eq("category",e.category)),(null==e?void 0:e.search)&&(t=t.ilike("title","%".concat(e.search,"%")));let{data:r,error:a}=await t.order("created_at",{ascending:!1});return{data:r,error:a}},getCourse:async e=>{let{data:t,error:r}=await s.from("courses").select("\n        *,\n        instructor:profiles!instructor_id(full_name, avatar_url, email),\n        lessons(*),\n        reviews(id, rating, comment, created_at, user:profiles(full_name, avatar_url))\n      ").eq("id",e).single();return{data:t,error:r}},createCourse:async e=>{let{data:t,error:r}=await s.from("courses").insert(e).select().single();return{data:t,error:r}},updateCourse:async(e,t)=>{let{data:r,error:a}=await s.from("courses").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();return{data:r,error:a}},deleteCourse:async e=>{let{error:t}=await s.from("courses").delete().eq("id",e);return{error:t}},createLesson:async e=>{let{data:t,error:r}=await s.from("lessons").insert(e).select().single();return{data:t,error:r}},updateLesson:async(e,t)=>{let{data:r,error:a}=await s.from("lessons").update(t).eq("id",e).select().single();return{data:r,error:a}},deleteLesson:async e=>{let{error:t}=await s.from("lessons").delete().eq("id",e);return{error:t}},getEnrollment:async(e,t)=>{let{data:r,error:a}=await s.from("enrollments").select("*").eq("user_id",e).eq("course_id",t).single();return{data:r,error:a}},getUserEnrollments:async e=>{let{data:t,error:r}=await s.from("enrollments").select("\n        *,\n        course:courses(*, instructor:profiles!instructor_id(full_name), lessons(id))\n      ").eq("user_id",e).order("enrolled_at",{ascending:!1});return{data:t,error:r}},createEnrollment:async(e,t)=>{let{data:r,error:a}=await s.from("enrollments").insert({user_id:e,course_id:t}).select().single();return{data:r,error:a}},updateProgress:async(e,t)=>{let{data:r,error:a}=await s.from("enrollments").update({progress:t}).eq("id",e).select().single();return{data:r,error:a}},createReview:async e=>{let{data:t,error:r}=await s.from("reviews").insert(e).select().single();return{data:t,error:r}},updateReview:async(e,t)=>{let{data:r,error:a}=await s.from("reviews").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();return{data:r,error:a}},getUserReview:async(e,t)=>{let{data:r,error:a}=await s.from("reviews").select("*").eq("user_id",e).eq("course_id",t).single();return{data:r,error:a}}},n={uploadAvatar:async(e,t)=>{let r=t.name.split(".").pop(),a="".concat(e,".").concat(r),{data:l,error:n}=await s.storage.from("avatars").upload(a,t,{upsert:!0});if(n)return{data:null,error:n};let{data:{publicUrl:i}}=s.storage.from("avatars").getPublicUrl(a);return{data:i,error:null}},uploadThumbnail:async(e,t)=>{let r=t.name.split(".").pop(),a="".concat(e,".").concat(r),{data:l,error:n}=await s.storage.from("thumbnails").upload(a,t,{upsert:!0});if(n)return{data:null,error:n};let{data:{publicUrl:i}}=s.storage.from("thumbnails").getPublicUrl(a);return{data:i,error:null}},uploadCourseFile:async(e,t)=>{let r=t.name.split(".").pop(),a="".concat(e,"/").concat(Date.now(),".").concat(r),{data:l,error:n}=await s.storage.from("course-files").upload(a,t);if(n)return{data:null,error:n};let{data:{publicUrl:i}}=s.storage.from("course-files").getPublicUrl(a);return{data:i,error:null}}}}},function(e){e.O(0,[699,250,126,971,69,744],function(){return e(e.s=6476)}),_N_E=e.O()}]);